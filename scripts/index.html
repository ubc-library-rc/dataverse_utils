<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Scripts - dataverse_utils</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Scripts";
    var mkdocs_page_input_path = "scripts.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> dataverse_utils</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Overview</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../api_ref/">API reference</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Scripts</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#dv_delpy">dv_del.py</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#dv_manifest_genpy">dv_manifest_gen.py</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#dv_upload_tsvpy">dv_upload_tsv.py</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#dv_releasepy">dv_release.py</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#dv_ldc_uploaderpy">dv_ldc_uploader.py</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#notes-for-windows-users">Notes for Windows users</a>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../faq/">FAQ</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../credits/">Credits</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">dataverse_utils</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Scripts</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="utility-scripts">Utility scripts<a class="headerlink" href="#utility-scripts" title="Permanent link">&para;</a></h1>
<style>
code {
  white-space : pre-wrap !important;
}
</style>

<p>These scripts are available at the command line/command prompt and don&rsquo;t require any Python knowledge except how to install a Python library via pip, as outlined in the <a href="..">overview</a> document.</p>
<p>Once installed via pip, the scripts <a href="#footnote"><em>should</em></a> be available via the command line and will not require calling Python explicitly. That is, they can be called from the command line directly. For example:</p>
<p><code>dv_tsv_manifest.py</code></p>
<p>is all you will need to type.</p>
<p>Note that these programs have been primarily tested on Linux and MacOS, with <a href="#footnote">Windows a tertiary priority</a>. Windows is notable for its unusual file  handling, so, as the MIT licenses stipulates, there is no warranty as to the suitability for a particular purpose.</p>
<p>Of course, they <em>should</em> work.</p>
<p>In no particular order:</p>
<h2 id="dv_delpy">dv_del.py<a class="headerlink" href="#dv_delpy" title="Permanent link">&para;</a></h2>
<p>This is bulk deletion utility for unpublished studies (or even single studies). It&rsquo;s useful when your automated procedures have gone wrong, or if you don&rsquo;t feel like navigating through many menus.</p>
<p>Note the <code>-i</code> switch which can ask for manual confirmation of deletions.</p>
<p><strong>Usage</strong></p>
<pre class="codehilite"><code class="language-nohighlight">usage: dv_del.py [-h] -k KEY [-d DATAVERSE | -p PID] [-i] [-u DVURL] [--version]

Delete draft studies from a Dataverse collection

optional arguments:
  -h, --help            show this help message and exit
  -k KEY, --key KEY     Dataverse user API key
  -d DATAVERSE, --dataverse DATAVERSE
                        Dataverse collection short name from which to delete all draft records. eg. &quot;ldc&quot;
  -p PID, --persistentId PID
                        Handle or DOI to delete in format hdl:11272.1/FK2/12345
  -i, --interactive     Confirm each study deletion
  -u DVURL, --url DVURL
                        URL to base Dataverse installation
  --version             Show version number and exit</code></pre>


<h2 id="dv_manifest_genpy">dv_manifest_gen.py<a class="headerlink" href="#dv_manifest_genpy" title="Permanent link">&para;</a></h2>
<p>Not technically a Dataverse-specific script, this utility will generate a tab-separated value output. The file consists of 3 columns: <strong>file, description and tags</strong>. </p>
<p>Editing the result and using the upload utility to parse the tsv will add descriptive metadata, tags and file paths to an upload instead of laboriously using the Dataverse GUI.</p>
<p>Tags may be separated by commas, eg: &ldquo;Data, SAS, June 2021&rdquo;.</p>
<p>Using stdout and a redirect will also save time. First dump a file as normal. Add other files to the end with different information using the exclude header switch <code>-x</code> and different tags along with output redirection <code>&gt;&gt;</code>.</p>
<p><strong>Usage</strong></p>
<pre class="codehilite"><code class="language-nohighlight">usage: dv_manifest_gen.py [-h] [-f FILENAME] [-t TAG] [-x] [-r] [-a] [--version] [files [files ...]]

Creates a file manifest in tab separated value format which can then be edited and used for file uploads to a Dataverse collection. Files can be edited to add file descriptions and
comma-separated tags that will be automatically attached to metadata using products using the dataverse_utils library. Will dump to stdout unless -f or --filename is used. Using the
command and a dash (ie, &quot;dv_manifest_gen.py -&quot; produces full paths for some reason.

positional arguments:
  files                 Files to add to manifest. Leaving it blank will add all files in the current directory. If using -r will recursively show all.

optional arguments:
  -h, --help            show this help message and exit
  -f FILENAME, --filename FILENAME
                        Save to file instead of outputting to stdout
  -t TAG, --tag TAG     Default tag(s). Separate with comma and use quotes if there are spaces. eg. &quot;Data, June 2021&quot;. Defaults to &quot;Data&quot;
  -x, --no-header       Don't include header in output. Useful if creating a complex tsv using redirects (ie, &quot;&gt;&gt;&quot;).
  -r, --recursive       Recursive listing.
  -a, --show-hidden     Include hidden files.
  --version             Show version number and exit</code></pre>


<h2 id="dv_upload_tsvpy">dv_upload_tsv.py<a class="headerlink" href="#dv_upload_tsvpy" title="Permanent link">&para;</a></h2>
<p>Now that you have a tsv full of nicely described data, you can easily upload it to an existing study if you know the persistent ID and have an API key.</p>
<p>For the best metadata, you should probably edit it manually to add correct descriptive metadata, notably the &ldquo;Description&rdquo; and &ldquo;Tags&rdquo;. Tags are split separated by commas, so it&rsquo;s possible to have multiple tags for each data item, like &ldquo;Data, SPSS, June 2021&rdquo;.</p>
<p>File paths are automatically generated from the &ldquo;file&rdquo; column. Because of this, you should probably use relative paths rather than absolute paths unless you want to have a lengthy path string in Dataverse.</p>
<p><strong>Usage</strong></p>
<pre class="codehilite"><code class="language-nohighlight">usage: dv_upload_tsv.py [-h] -p PID -k KEY [-u URL] [-r] [-t TRUNCATE] [--version] [tsv]

Uploads data sets to an *existing* Dataverse study from the contents of a TSV (tab separated value) file. Metadata, file tags, paths, etc are all read from the TSV. JSON output from the
Dataverse API is printed to stdout during the process.

positional arguments:
  tsv                   TSV file to upload

optional arguments:
  -h, --help            show this help message and exit
  -p PID, --pid PID     Dataverse study persistent identifier (DOI/handle)
  -k KEY, --key KEY     API key
  -u URL, --url URL     Dataverse installation base url. defaults to &quot;https://abacus.library.ubc.ca&quot;
  -r, --restrict        Restrict files after upload.
  -t TRUNCATE, --truncate TRUNCATE
                        Left truncate file path. As Dataverse studies can retain directory structure, you can set an arbitrary starting point by removing the leftmost portion. Eg: if the
                        TSV has a file path of /home/user/Data/file.txt, setting --truncate to &quot;/home/user&quot; would have file.txt in the Data directory in the Dataverse study. The file is
                        still loaded from the path in the spreadsheet. Defaults to no truncation.
  --version             Show version number and exit</code></pre>


<h2 id="dv_releasepy">dv_release.py<a class="headerlink" href="#dv_releasepy" title="Permanent link">&para;</a></h2>
<p>A bulk release utility for Dataverse. This utility will normally be used after a migration or large data transfer, such as a <a href="https://ubc-library-rc.github.io/dryad2dataverse">dryad2dataverse</a> transfer from the Dryad data repository. It can release studies individually by persistent ID or just release all unreleased files in a Dataverse.</p>
<p><strong>Usage</strong></p>
<pre class="codehilite"><code class="language-nohighlight">usage: dv_release.py [-h] [-u URL] -k KEY [-i] [--time STIME] [-v] [-r] [-d DV | -p PID [PID ...]] [--version]

Bulk file releaser for unpublished Dataverse studies. Either releases individual studies or all unreleased studies in a single Dataverse collection.

optional arguments:
  -h, --help            show this help message and exit
  -u URL, --url URL     Dataverse installation base URL. Default: https://abacus.library.ubc.ca
  -k KEY, --key KEY     API key
  -i, --interactive     Manually confirm each release
  --time STIME, -t STIME
                        Time between release attempts in seconds. Default 10
  -v                    Verbose mode
  -r, --dry-run         Only output a list of studies to be released
  -d DV, --dv DV        Short name of Dataverse collection to process (eg: statcan)
  -p PID [PID ...], --pid PID [PID ...]
                        Handles or DOIs to release in format hdl:11272.1/FK2/12345 or doi:10.80240/FK2/NWRABI. Multiple values OK
  --version             Show version number and exit</code></pre>


<h2 id="dv_ldc_uploaderpy">dv_ldc_uploader.py<a class="headerlink" href="#dv_ldc_uploaderpy" title="Permanent link">&para;</a></h2>
<p>This is a very specialized utility which will scrape metadata from the <a href="https://www.ldc.upenn.edu/">Linguistic Data Consortium</a> (LDC) and create a metadata record in a Dataverse. The LDC does not have an API, so the metadata is scraped from their web site. This means that the metadata may not be quite as controlled as that which comes from an API. </p>
<p>Data from the LDC website is converted to <a href="https://datadryad.org">Dryad</a>-style JSON via <code>dataverse_utils.ldc</code> via the use of the <a href="https://ubc-library-rc.github.io/dryad2dataverse">dryad2dataverse</a> library.</p>
<p>There are two main methods of use for this utility:</p>
<ol>
<li>
<p>Multiple metadata uploads. Multiple LDC record numbers can be supplied and a study without files will be created for each one.</p>
</li>
<li>
<p>If a TSV file with file information is upplied via the <code>-t</code> or <code>--tsv</code> switch, the utility will upload a single LDC study and upload the contents of the tsv file to the created record.</p>
</li>
</ol>
<p><strong>Usage</strong></p>
<pre class="codehilite"><code class="language-nohighlight">usage: dv_ldc_uploader.py [-h] [-u URL] -k KEY [-d DVS] [-t TSV] [-n CNAME] [-e EMAIL] [-v] [--version] studies [studies ...]

Linguistic Data Consortium metadata uploader for Dataverse. This utility will scrape the metadata from the LDC website (https://catalog.ldc.upenn.edu) and upload data based on a TSV
manifest. Please note that this utility was built with the Abacus repository (https://abacus.library.ubc.ca) in mind, so many of the defaults are specific to that Dataverse installation.

positional arguments:
  studies               LDC Catalogue numbers to process, separated by spaces. eg. &quot;LDC2012T19 LDC2011T07&quot;. Case is ignored, so &quot;ldc2012T19&quot; will also work.

optional arguments:
  -h, --help            show this help message and exit
  -u URL, --url URL     Dataverse installation base URL. Defaults to &quot;https://abacus.library.ubc.ca&quot;
  -k KEY, --key KEY     API key
  -d DVS, --dvs DVS     Short name of target Dataverse collection (eg: ldc). Defaults to &quot;ldc&quot;
  -t TSV, --tsv TSV     Manifest tsv file for uploading and metadata. If not supplied, only metadata will be uploaded. Using this option requires only one positional *studies* argument
  -n CNAME, --cname CNAME
                        Study contact name. Default: &quot;Abacus support&quot;
  -e EMAIL, --email EMAIL
                        Dataverse study contact email address. Default: abacus-support@lists.ubc.ca
  -v, --verbose         Verbose output
  --version             Show version number and exit</code></pre>


<p><a name='footnote' /></p>
<h2 id="notes-for-windows-users">Notes for Windows users<a class="headerlink" href="#notes-for-windows-users" title="Permanent link">&para;</a></h2>
<p>Command line scripts for Python may not necessarily behave the way they do in Linux/Mac, depending on <em>how</em> you access them. For detailed information on Windows systems, please see the <a href="../windows/">Windows testing document</a></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../faq/" class="btn btn-neutral float-right" title="FAQ">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../api_ref/" class="btn btn-neutral" title="API reference"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../api_ref/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../faq/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
