<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>API reference - dataverse_utils</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "API reference";
        var mkdocs_page_input_path = "api_ref.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> dataverse_utils
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Overview</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../scripts/">Console utilities</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">API reference</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#dataverse_utils">dataverse_utils</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#dataverse_utilsdvdata">dataverse_utils.dvdata</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#study-objects">Study Objects</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#__init__">__init__</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#get_version">get_version</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#set_version">set_version</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#fix_licence">fix_licence</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#production_location">production_location</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#file-objects">File Objects</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#__init___1">__init__</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#download_file">download_file</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#del_tempfile">del_tempfile</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#produce_digest">produce_digest</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#verify">verify</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#dataverse_utilsscriptsdv_record_copy">dataverse_utils.scripts.dv_record_copy</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#parsley">parsley</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#main">main</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#dataverse_utilsscriptsdv_study_migrator">dataverse_utils.scripts.dv_study_migrator</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#parsley_1">parsley</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#upload_file_to_target">upload_file_to_target</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#remove_target_files">remove_target_files</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#main_1">main</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#dataverse_utilsscriptsdv_ldc_uploader">dataverse_utils.scripts.dv_ldc_uploader</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#parse">parse</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#upload_meta">upload_meta</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#main_2">main</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#dataverse_utilsscriptsdv_pg_facet_date">dataverse_utils.scripts.dv_pg_facet_date</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#parsely">parsely</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#parse_dtype">parse_dtype</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#write_old">write_old</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#publicationdate-is-assumed-to-be-a-datetimedatetime-instance">publicationdate is assumed to be a datetime.datetime instance.</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#write_sql">write_sql</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#get_datetime">get_datetime</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fetch_date_api">fetch_date_api</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#reindex">reindex</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#main_3">main</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#dataverse_utilsscriptsdv_release">dataverse_utils.scripts.dv_release</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#argp">argp</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#dverse-objects">Dverse Objects</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#__init___2">__init__</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#study_list">study_list</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#unreleased">unreleased</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#study-objects_1">Study Objects</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#__init___3">__init__</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#status_ok">status_ok</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#release_me">release_me</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#main_4">main</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#dataverse_utilsscriptsdv_del">dataverse_utils.scripts.dv_del</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#delstudy">delstudy</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#conf">conf</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#getsize">getsize</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#parsley_2">parsley</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#main_5">main</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#dataverse_utilsscriptsdv_replace_licence">dataverse_utils.scripts.dv_replace_licence</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#parsley_3">parsley</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#replace_licence">replace_licence</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#republish">republish</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#print_stat">print_stat</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#main_6">main</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#dataverse_utilsscriptsdv_upload_tsv">dataverse_utils.scripts.dv_upload_tsv</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#parse_1">parse</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#main_7">main</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#dataverse_utilsscriptsdv_manifest_gen">dataverse_utils.scripts.dv_manifest_gen</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#parse_2">parse</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#quotype">quotype</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#main_8">main</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#dataverse_utilsdataverse_utils">dataverse_utils.dataverse_utils</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#dvgeneraluploaderror-objects">DvGeneralUploadError Objects</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#md5error-objects">Md5Error Objects</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#make_tsv">make_tsv</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#dump_tsv">dump_tsv</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#file_path">file_path</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#check_lock">check_lock</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#force_notab_unlock">force_notab_unlock</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#uningest_file">uningest_file</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#upload_file">upload_file</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#restrict_file">restrict_file</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#upload_from_tsv">upload_from_tsv</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#dataverse_utilsldc">dataverse_utils.ldc</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#ldc-objects">Ldc Objects</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#__init___4">__init__</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#ldcjson">ldcJson</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#dryadjson">dryadJson</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#dvjson">dvJson</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#embargo">embargo</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#filejson">fileJson</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#files">files</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#fetch_record">fetch_record</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#make_ldc_json">make_ldc_json</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#name_parser">name_parser</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#make_dryad_json">make_dryad_json</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#find_block_index">find_block_index</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#make_dv_json">make_dv_json</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#upload_metadata">upload_metadata</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../faq/">FAQ</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../windows/">Windows notes</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../credits/">Credits</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">dataverse_utils</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>API reference</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="api-reference">API Reference<a class="headerlink" href="#api-reference" title="Permanent link">&para;</a></h1>
<p><a id="dataverse_utils"></a></p>
<h2 id="dataverse_utils">dataverse_utils<a class="headerlink" href="#dataverse_utils" title="Permanent link">&para;</a></h2>
<p>Generalized dataverse utilities. Note that
<code>import dataverse_utils</code> is the equivalent of
<code>import dataverse_utils.dataverse_utils</code></p>
<p><a id="dataverse_utils.dvdata"></a></p>
<h2 id="dataverse_utilsdvdata">dataverse_utils.dvdata<a class="headerlink" href="#dataverse_utilsdvdata" title="Permanent link">&para;</a></h2>
<p>Dataverse studies and files</p>
<p><a id="dataverse_utils.dvdata.Study"></a></p>
<h3 id="study-objects">Study Objects<a class="headerlink" href="#study-objects" title="Permanent link">&para;</a></h3>
<pre><code class="language-python">class Study(dict)
</code></pre>
<p>Dataverse record. Dataverse study records are pure metadata so this
is represented with a dictionary.</p>
<p><a id="dataverse_utils.dvdata.Study.__init__"></a></p>
<h5 id="__init__">__init__<a class="headerlink" href="#__init__" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def __init__(pid: str, url: str, key: str, **kwargs)
</code></pre>
<p>pid : str
    Record persistent identifier: hdl or doi
url : str
    Base URL to host Dataverse instance
key : str
    Dataverse API key with downloader privileges</p>
<p><a id="dataverse_utils.dvdata.Study.get_version"></a></p>
<h5 id="get_version">get_version<a class="headerlink" href="#get_version" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">@classmethod
def get_version(cls, url: str, timeout: int = 100) -&gt; float
</code></pre>
<p>Returns a float representing a Dataverse version number.
Floating point value composed of:
float(f&rsquo;{major_version}.{minor_verson:03d}{patch:03d}&rsquo;)
ie, version 5.9.2 would be 5.009002
url : str
    URL of base Dataverse instance. eg: &lsquo;https://abacus.library.ubc.ca&rsquo;
timeout : int
    Request timeout in seconds</p>
<p><a id="dataverse_utils.dvdata.Study.set_version"></a></p>
<h5 id="set_version">set_version<a class="headerlink" href="#set_version" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def set_version(url: str, timeout: int = 100) -&gt; None
</code></pre>
<p>Sets self[&lsquo;target_version&rsquo;] to appropriate integer value <em>AND</em>
formats self[&lsquo;upload_json&rsquo;] to correct JSON format</p>
<p>url : str
    URL of <em>target</em> Dataverse instance
timeout : int
    request timeout in seconds</p>
<p><a id="dataverse_utils.dvdata.Study.fix_licence"></a></p>
<h5 id="fix_licence">fix_licence<a class="headerlink" href="#fix_licence" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def fix_licence() -&gt; None
</code></pre>
<p>With Dataverse v5.10+, a licence type of &lsquo;NONE&rsquo; is now forbidden.
Now, as per <a href="https://guides.dataverse.org/en/5.14/api/sword.html        ?highlight=invalid%20license">https://guides.dataverse.org/en/5.14/api/sword.html        ?highlight=invalid%20license</a>,
non-standard licences may be replaced with None.</p>
<p>This function edits the same Study object <em>in place</em>, so returns nothing.</p>
<p><a id="dataverse_utils.dvdata.Study.production_location"></a></p>
<h5 id="production_location">production_location<a class="headerlink" href="#production_location" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def production_location() -&gt; None
</code></pre>
<p>Changes &ldquo;multiple&rdquo; to True where typeName == &lsquo;productionPlace&rsquo; in
Study[&lsquo;upload_json&rsquo;] Changes are done
<em>in place</em>.
This change came into effect with Dataverse v5.13</p>
<p><a id="dataverse_utils.dvdata.File"></a></p>
<h3 id="file-objects">File Objects<a class="headerlink" href="#file-objects" title="Permanent link">&para;</a></h3>
<pre><code class="language-python">class File(dict)
</code></pre>
<p>Class representing a file on a Dataverse instance</p>
<p><a id="dataverse_utils.dvdata.File.__init__"></a></p>
<h5 id="__init___1">__init__<a class="headerlink" href="#__init___1" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def __init__(url: str, key: str, **kwargs)
</code></pre>
<p>url : str
    Base URL to host Dataverse instance
key : str
    Dataverse API key with downloader privileges
id : int or str
    File identifier; can be a file ID or PID
args : list
kwargs : dict</p>
<p>To initialize correctly, pass a value from Study[&lsquo;file_info&rsquo;].</p>
<p>Eg: File(&lsquo;https://test.invalid&rsquo;, &lsquo;ABC123&rsquo;, **Study_instance[&lsquo;file_info&rsquo;][0])</p>
<p><a id="dataverse_utils.dvdata.File.download_file"></a></p>
<h5 id="download_file">download_file<a class="headerlink" href="#download_file" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def download_file()
</code></pre>
<p>Downloads the file to a temporary location. Data will be in the ORIGINAL format,
not Dataverse-processed TSVs</p>
<p><a id="dataverse_utils.dvdata.File.del_tempfile"></a></p>
<h5 id="del_tempfile">del_tempfile<a class="headerlink" href="#del_tempfile" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def del_tempfile()
</code></pre>
<p>Delete tempfile if it exists</p>
<p><a id="dataverse_utils.dvdata.File.produce_digest"></a></p>
<h5 id="produce_digest">produce_digest<a class="headerlink" href="#produce_digest" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def produce_digest(prot: str = 'md5', blocksize: int = 2**16) -&gt; str
</code></pre>
<p>Returns hex digest for object</p>
<pre class="codehilite"><code>fname : str
   Path to a file object

prot : str
   Hash type. Supported hashes: 'sha1', 'sha224', 'sha256',
      'sha384', 'sha512', 'blake2b', 'blake2s', 'md5'.
      Default: 'md5'

blocksize : int
   Read block size in bytes
</code></pre>

<p><a id="dataverse_utils.dvdata.File.verify"></a></p>
<h5 id="verify">verify<a class="headerlink" href="#verify" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def verify() -&gt; None
</code></pre>
<p>Compares checksum with stated checksum</p>
<p><a id="dataverse_utils.scripts.dv_record_copy"></a></p>
<h2 id="dataverse_utilsscriptsdv_record_copy">dataverse_utils.scripts.dv_record_copy<a class="headerlink" href="#dataverse_utilsscriptsdv_record_copy" title="Permanent link">&para;</a></h2>
<p>Copies a dataverse record to collection
OR copies a record to an existing PID.</p>
<p>That way all you have to do
is edit a few fields in the GUI instead of
painfully editing JSON or painfully using the
Dataverse GUI.</p>
<p><a id="dataverse_utils.scripts.dv_record_copy.parsley"></a></p>
<h5 id="parsley">parsley<a class="headerlink" href="#parsley" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def parsley() -&gt; argparse.ArgumentParser()
</code></pre>
<p>Parses the arguments from the command line.</p>
<p>Returns argparse.ArgumentParser</p>
<p><a id="dataverse_utils.scripts.dv_record_copy.main"></a></p>
<h5 id="main">main<a class="headerlink" href="#main" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def main()
</code></pre>
<p>You know what this does</p>
<p><a id="dataverse_utils.scripts.dv_study_migrator"></a></p>
<h2 id="dataverse_utilsscriptsdv_study_migrator">dataverse_utils.scripts.dv_study_migrator<a class="headerlink" href="#dataverse_utilsscriptsdv_study_migrator" title="Permanent link">&para;</a></h2>
<p>Copies an entire record and migrates it <em>including the data</em></p>
<p><a id="dataverse_utils.scripts.dv_study_migrator.parsley"></a></p>
<h5 id="parsley_1">parsley<a class="headerlink" href="#parsley_1" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def parsley() -&gt; argparse.ArgumentParser()
</code></pre>
<p>Parses the arguments from the command line.</p>
<p>Returns argparse.ArgumentParser</p>
<p><a id="dataverse_utils.scripts.dv_study_migrator.upload_file_to_target"></a></p>
<h5 id="upload_file_to_target">upload_file_to_target<a class="headerlink" href="#upload_file_to_target" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def upload_file_to_target(indict: dict, pid, source_url, source_key,
                          target_url, target_key)
</code></pre>
<p>Uploads a single file with metadata to a dataverse record</p>
<p><a id="dataverse_utils.scripts.dv_study_migrator.remove_target_files"></a></p>
<h5 id="remove_target_files">remove_target_files<a class="headerlink" href="#remove_target_files" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def remove_target_files(record: dataverse_utils.dvdata.Study,
                        timeout: int = 100)
</code></pre>
<p>Removes all files from a dataverse record.
    record: dataverse_utils.dvdata.Study
    timeout: int
        Timeout in seconds</p>
<p><a id="dataverse_utils.scripts.dv_study_migrator.main"></a></p>
<h5 id="main_1">main<a class="headerlink" href="#main_1" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def main()
</code></pre>
<p>Run this, obviously</p>
<p><a id="dataverse_utils.scripts.dv_ldc_uploader"></a></p>
<h2 id="dataverse_utilsscriptsdv_ldc_uploader">dataverse_utils.scripts.dv_ldc_uploader<a class="headerlink" href="#dataverse_utilsscriptsdv_ldc_uploader" title="Permanent link">&para;</a></h2>
<p>Auto download/upload LDC metadata and files.</p>
<p>python3 uploadme.py LDC20201S01 . . . LDC2021T21 apikey</p>
<p><a id="dataverse_utils.scripts.dv_ldc_uploader.parse"></a></p>
<h5 id="parse">parse<a class="headerlink" href="#parse" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def parse() -&gt; argparse.ArgumentParser()
</code></pre>
<p>Parses the arguments from the command line.</p>
<p>Returns argparse.ArgumentParser</p>
<p><a id="dataverse_utils.scripts.dv_ldc_uploader.upload_meta"></a></p>
<h5 id="upload_meta">upload_meta<a class="headerlink" href="#upload_meta" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def upload_meta(ldccat: str,
                url: str,
                key: str,
                dvs: str,
                verbose: bool = False,
                certchain: str = None) -&gt; str
</code></pre>
<p>Uploads metadata to target dataverse collection. Returns persistentId.</p>
<p>ldccat : str
    Linguistic Data Consortium catalogue number
url : str
    URL to base instance of Dataverse installation
key : str
    API key
dvs : str
    Target Dataverse collection short name
certchain : str
    Path to LDC .PEM certificate chain</p>
<p><a id="dataverse_utils.scripts.dv_ldc_uploader.main"></a></p>
<h5 id="main_2">main<a class="headerlink" href="#main_2" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def main() -&gt; None
</code></pre>
<p>Uploads metadata and data to Dataverse collection/study respectively</p>
<p><a id="dataverse_utils.scripts.dv_pg_facet_date"></a></p>
<h2 id="dataverse_utilsscriptsdv_pg_facet_date">dataverse_utils.scripts.dv_pg_facet_date<a class="headerlink" href="#dataverse_utilsscriptsdv_pg_facet_date" title="Permanent link">&para;</a></h2>
<p>Reads the date from a Dataverse study and forces the facet sidebar to use that
date by manually updating the Dataverse Postgres database.</p>
<p>This <em>must</em> be run on the server that hosts a Dataverse installation,
and the user must supply, at a minimum, the database password and
a persistent ID to be read, as well as a date type.</p>
<p>Requires two non-standard python libraries: psycopg2
(use psycopg2-binary to avoid installing from source) and requests.</p>
<p>Psycopg2 is not part of the requirements for dataverse_utils
because it is only used for the server portion of these utilities,
and hence useless for them.</p>
<p><a id="dataverse_utils.scripts.dv_pg_facet_date.parsely"></a></p>
<h5 id="parsely">parsely<a class="headerlink" href="#parsely" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def parsely() -&gt; argparse.ArgumentParser
</code></pre>
<p>Command line argument parser</p>
<p><a id="dataverse_utils.scripts.dv_pg_facet_date.parse_dtype"></a></p>
<h5 id="parse_dtype">parse_dtype<a class="headerlink" href="#parse_dtype" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def parse_dtype(dtype) -&gt; str
</code></pre>
<p>Returns correctly formatted date type string for Dataverse API</p>
<hr />
<p>dtype : str
    One of the allowable values from the parser</p>
<p><a id="dataverse_utils.scripts.dv_pg_facet_date.write_old"></a></p>
<h5 id="write_old">write_old<a class="headerlink" href="#write_old" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def write_old(data) -&gt; None
</code></pre>
<p>Writes older data to a tsv file. Assumes 4 values per item:
id, authority, identifier, publicationdate.</p>
<h2 id="publicationdate-is-assumed-to-be-a-datetimedatetime-instance">publicationdate is assumed to be a datetime.datetime instance.<a class="headerlink" href="#publicationdate-is-assumed-to-be-a-datetimedatetime-instance" title="Permanent link">&para;</a></h2>
<p><strong>Arguments</strong>:</p>
<p>data : list
  Postqres query output list (ie, data = cursor.fetchall())</p>
<p><a id="dataverse_utils.scripts.dv_pg_facet_date.write_sql"></a></p>
<h5 id="write_sql">write_sql<a class="headerlink" href="#write_sql" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def write_sql(data) -&gt; None
</code></pre>
<p>Write SQL to file</p>
<p><a id="dataverse_utils.scripts.dv_pg_facet_date.get_datetime"></a></p>
<h5 id="get_datetime">get_datetime<a class="headerlink" href="#get_datetime" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def get_datetime(datestr) -&gt; (datetime.datetime, str)
</code></pre>
<p>Return datetime from poorly formatted Dataverse dates string</p>
<hr />
<p>datestr : str
    Dataverse date returned by API</p>
<p><a id="dataverse_utils.scripts.dv_pg_facet_date.fetch_date_api"></a></p>
<h5 id="fetch_date_api">fetch_date_api<a class="headerlink" href="#fetch_date_api" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def fetch_date_api(url, key, pid, dtype) -&gt; str
</code></pre>
<p>Returns the requested date string from the Dataverse study record</p>
<hr />
<p>url : str
    Base URL of Dataverse installation
key :str
    API key for Dataverse user
pid : str
    Persistent identifier for Dataverse study
dtype : str
    Date type required</p>
<p><a id="dataverse_utils.scripts.dv_pg_facet_date.reindex"></a></p>
<h5 id="reindex">reindex<a class="headerlink" href="#reindex" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def reindex(pid) -&gt; dict
</code></pre>
<p>Reindexes study in place. Localhost access only.</p>
<hr />
<p>pid : str
    PersistentId for Dataverse study</p>
<p><a id="dataverse_utils.scripts.dv_pg_facet_date.main"></a></p>
<h5 id="main_3">main<a class="headerlink" href="#main_3" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def main()
</code></pre>
<p>The heart of the application</p>
<p><a id="dataverse_utils.scripts.dv_release"></a></p>
<h2 id="dataverse_utilsscriptsdv_release">dataverse_utils.scripts.dv_release<a class="headerlink" href="#dataverse_utilsscriptsdv_release" title="Permanent link">&para;</a></h2>
<p>Bulk release script for Dataverse.</p>
<p>This is almost identical to the dryad2dataverse bulk
releaser except that the defaults are changed to
https://abacus.library.ubc.ca</p>
<p><a id="dataverse_utils.scripts.dv_release.argp"></a></p>
<h5 id="argp">argp<a class="headerlink" href="#argp" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def argp()
</code></pre>
<p>Parses the arguments from the command line.</p>
<p>Returns arparse.ArgumentParser</p>
<p><a id="dataverse_utils.scripts.dv_release.Dverse"></a></p>
<h3 id="dverse-objects">Dverse Objects<a class="headerlink" href="#dverse-objects" title="Permanent link">&para;</a></h3>
<pre><code class="language-python">class Dverse()
</code></pre>
<p>An object representing a Dataverse installation</p>
<p><a id="dataverse_utils.scripts.dv_release.Dverse.__init__"></a></p>
<h5 id="__init___2">__init__<a class="headerlink" href="#__init___2" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def __init__(dvurl, apikey, dvs)
</code></pre>
<p>Intializes Dataverse installation object.</p>
<p><strong>Arguments</strong>:</p>
<ul>
<li><code>dvurl</code>: str. URL to base Dataverse installation
(eg. &lsquo;https://abacus.library.ubc.ca&rsquo;)</li>
<li><code>apikey</code>: str. API key for Dataverse user</li>
<li><code>dv</code>: str. Short name of target Dataverse collection (eg. &lsquo;statcan&rsquo;)</li>
</ul>
<p><a id="dataverse_utils.scripts.dv_release.Dverse.study_list"></a></p>
<h5 id="study_list">study_list<a class="headerlink" href="#study_list" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">@property
def study_list() -&gt; list
</code></pre>
<p>Returns a list of all studies (published or not) in
the Dataverse collection</p>
<p><a id="dataverse_utils.scripts.dv_release.Dverse.unreleased"></a></p>
<h5 id="unreleased">unreleased<a class="headerlink" href="#unreleased" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">@property
def unreleased(all_stud: list = None) -&gt; list
</code></pre>
<p>Finds only unreleased studies from a list of studies</p>
<p><strong>Arguments</strong>:</p>
<ul>
<li><code>all_stud</code>: list. List of Dataverse studies. Defaults to output of
Dverse.get_study_list()</li>
</ul>
<p><a id="dataverse_utils.scripts.dv_release.Study"></a></p>
<h3 id="study-objects_1">Study Objects<a class="headerlink" href="#study-objects_1" title="Permanent link">&para;</a></h3>
<pre><code class="language-python">class Study()
</code></pre>
<p>Instance representing a Dataverse study</p>
<p><a id="dataverse_utils.scripts.dv_release.Study.__init__"></a></p>
<h5 id="__init___3">__init__<a class="headerlink" href="#__init___3" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def __init__(**kwargs)
</code></pre>
<p>:kwarg dvurl: str. Base URL for Dataverse instance
:kwarg apikey: str. API key for Dataverse user
:kwarg pid: str. Persistent identifier for study
:kwarg stime: int. Time between file lock checks. Default 10
:kwarg verbose: Verbose output. Default False</p>
<p><a id="dataverse_utils.scripts.dv_release.Study.status_ok"></a></p>
<h5 id="status_ok">status_ok<a class="headerlink" href="#status_ok" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def status_ok()
</code></pre>
<p>Checks to see if study has a lock. Returns True if OK to continue, else False.</p>
<p><a id="dataverse_utils.scripts.dv_release.Study.release_me"></a></p>
<h5 id="release_me">release_me<a class="headerlink" href="#release_me" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def release_me(interactive=False)
</code></pre>
<p>Releases study and waits until it&rsquo;s unlocked before returning to the function</p>
<p><a id="dataverse_utils.scripts.dv_release.main"></a></p>
<h5 id="main_4">main<a class="headerlink" href="#main_4" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def main()
</code></pre>
<p>The primary function. Will release all unreleased studies in the
the target Dataverse collection, or selected studies as required.</p>
<p><a id="dataverse_utils.scripts.dv_del"></a></p>
<h2 id="dataverse_utilsscriptsdv_del">dataverse_utils.scripts.dv_del<a class="headerlink" href="#dataverse_utilsscriptsdv_del" title="Permanent link">&para;</a></h2>
<p>Dataverse Bulk Deleter
Deletes unpublished studies at the command line</p>
<p><a id="dataverse_utils.scripts.dv_del.delstudy"></a></p>
<h5 id="delstudy">delstudy<a class="headerlink" href="#delstudy" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def delstudy(dvurl, key, pid)
</code></pre>
<p>Deletes Dataverse study</p>
<p>dvurl : str
    Dataverse installation base URL
key : str
    Dataverse user API key
pid : str
    Dataverse collection study persistent identifier</p>
<p><a id="dataverse_utils.scripts.dv_del.conf"></a></p>
<h5 id="conf">conf<a class="headerlink" href="#conf" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def conf(tex)
</code></pre>
<p>Confirmation dialogue checker. Returns true if &ldquo;Y&rdquo; or &ldquo;y&rdquo;</p>
<p><a id="dataverse_utils.scripts.dv_del.getsize"></a></p>
<h5 id="getsize">getsize<a class="headerlink" href="#getsize" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def getsize(dvurl, pid, key)
</code></pre>
<p>Returns size of Dataverse study. Mostly here for debugging.
dvurl : str
    Dataverse installation base URL
pid : str
    Dataverse collection study persistent identifier
key : str
    Dataverse user API key</p>
<p><a id="dataverse_utils.scripts.dv_del.parsley"></a></p>
<h5 id="parsley_2">parsley<a class="headerlink" href="#parsley_2" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def parsley() -&gt; argparse.ArgumentParser
</code></pre>
<p>Argument parser as separate function</p>
<p><a id="dataverse_utils.scripts.dv_del.main"></a></p>
<h5 id="main_5">main<a class="headerlink" href="#main_5" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def main()
</code></pre>
<p>Command line bulk deleter</p>
<p><a id="dataverse_utils.scripts.dv_replace_licence"></a></p>
<h2 id="dataverse_utilsscriptsdv_replace_licence">dataverse_utils.scripts.dv_replace_licence<a class="headerlink" href="#dataverse_utilsscriptsdv_replace_licence" title="Permanent link">&para;</a></h2>
<p>Replace all licence in a study with one read from an external
markdown file. This requires using a different API, the
&ldquo;semantic metadata api&rdquo;
https://guides.dataverse.org/en/5.6/developers/
dataset-semantic-metadata-api.html</p>
<p><a id="dataverse_utils.scripts.dv_replace_licence.parsley"></a></p>
<h5 id="parsley_3">parsley<a class="headerlink" href="#parsley_3" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def parsley() -&gt; argparse.ArgumentParser()
</code></pre>
<p>parse the command line</p>
<p><a id="dataverse_utils.scripts.dv_replace_licence.replace_licence"></a></p>
<h5 id="replace_licence">replace_licence<a class="headerlink" href="#replace_licence" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def replace_licence(hdl, lic, key, url='https://abacus.library.ubc.ca')
</code></pre>
<p>Replace the licence for a dataverse study with
persistent ID hdl.</p>
<hr />
<p>hdl : str
    Dataverse persistent ID
lic : str
    Licence text in Markdown format
key : str
    Dataverse API key
url : str
    Dataverse installation base URL</p>
<p><a id="dataverse_utils.scripts.dv_replace_licence.republish"></a></p>
<h5 id="republish">republish<a class="headerlink" href="#republish" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def republish(hdl, key, url='https://abacus.library.ubc.ca')
</code></pre>
<p>Republish study without updating version</p>
<hr />
<p>hdl : str
    Persistent Id
key : str
    Dataverse API key
url : str
    Dataverse installation base URL</p>
<p><a id="dataverse_utils.scripts.dv_replace_licence.print_stat"></a></p>
<h5 id="print_stat">print_stat<a class="headerlink" href="#print_stat" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def print_stat(rjson)
</code></pre>
<p>Prints error status to stdout</p>
<p><a id="dataverse_utils.scripts.dv_replace_licence.main"></a></p>
<h5 id="main_6">main<a class="headerlink" href="#main_6" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def main()
</code></pre>
<p>Main script function</p>
<p><a id="dataverse_utils.scripts.dv_upload_tsv"></a></p>
<h2 id="dataverse_utilsscriptsdv_upload_tsv">dataverse_utils.scripts.dv_upload_tsv<a class="headerlink" href="#dataverse_utilsscriptsdv_upload_tsv" title="Permanent link">&para;</a></h2>
<p>Uploads data sets to a dataverse installation from the
contents of a TSV (tab separated value)
file. Metadata, file tags, paths, etc are all read
from the TSV.</p>
<p><a id="dataverse_utils.scripts.dv_upload_tsv.parse"></a></p>
<h5 id="parse_1">parse<a class="headerlink" href="#parse_1" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def parse() -&gt; argparse.ArgumentParser()
</code></pre>
<p>Parses the arguments from the command line.</p>
<p>Returns argparse.ArgumentParser</p>
<p><a id="dataverse_utils.scripts.dv_upload_tsv.main"></a></p>
<h5 id="main_7">main<a class="headerlink" href="#main_7" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def main() -&gt; None
</code></pre>
<p>Uploads data to an already existing Dataverse study</p>
<p><a id="dataverse_utils.scripts.dv_manifest_gen"></a></p>
<h2 id="dataverse_utilsscriptsdv_manifest_gen">dataverse_utils.scripts.dv_manifest_gen<a class="headerlink" href="#dataverse_utilsscriptsdv_manifest_gen" title="Permanent link">&para;</a></h2>
<p>Creates a file manifest in tab separated value format
which can be used with other dataverse_util library utilities
and functions to upload files complete with metadata.</p>
<p><a id="dataverse_utils.scripts.dv_manifest_gen.parse"></a></p>
<h5 id="parse_2">parse<a class="headerlink" href="#parse_2" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def parse() -&gt; argparse.ArgumentParser()
</code></pre>
<p>Parses the arguments from the command line.</p>
<p>Returns argparse.ArgumentParser</p>
<p><a id="dataverse_utils.scripts.dv_manifest_gen.quotype"></a></p>
<h5 id="quotype">quotype<a class="headerlink" href="#quotype" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def quotype(quote: str) -&gt; int
</code></pre>
<p>Parse quotation type for csv parser.</p>
<p>returns csv quote constant.</p>
<p><a id="dataverse_utils.scripts.dv_manifest_gen.main"></a></p>
<h5 id="main_8">main<a class="headerlink" href="#main_8" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def main() -&gt; None
</code></pre>
<p>The main function call</p>
<p><a id="dataverse_utils.dataverse_utils"></a></p>
<h2 id="dataverse_utilsdataverse_utils">dataverse_utils.dataverse_utils<a class="headerlink" href="#dataverse_utilsdataverse_utils" title="Permanent link">&para;</a></h2>
<p>A collection of Dataverse utilities for file and metadata
manipulation</p>
<p><a id="dataverse_utils.dataverse_utils.DvGeneralUploadError"></a></p>
<h3 id="dvgeneraluploaderror-objects">DvGeneralUploadError Objects<a class="headerlink" href="#dvgeneraluploaderror-objects" title="Permanent link">&para;</a></h3>
<pre><code class="language-python">class DvGeneralUploadError(Exception)
</code></pre>
<p>Raised on non-200 URL response</p>
<p><a id="dataverse_utils.dataverse_utils.Md5Error"></a></p>
<h3 id="md5error-objects">Md5Error Objects<a class="headerlink" href="#md5error-objects" title="Permanent link">&para;</a></h3>
<pre><code class="language-python">class Md5Error(Exception)
</code></pre>
<p>Raised on md5 mismatch</p>
<p><a id="dataverse_utils.dataverse_utils.make_tsv"></a></p>
<h5 id="make_tsv">make_tsv<a class="headerlink" href="#make_tsv" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def make_tsv(start_dir,
             in_list=None,
             def_tag='Data',
             inc_header=True,
             mime=False,
             quotype=csv.QUOTE_MINIMAL) -&gt; str
</code></pre>
<p>Recurses the tree for files and produces tsv output with
with headers &lsquo;file&rsquo;, &lsquo;description&rsquo;, &lsquo;tags&rsquo;.</p>
<p>The &lsquo;description&rsquo; is the filename without an extension.</p>
<p>Returns tsv as string.</p>
<hr />
<p><strong>Arguments</strong>:</p>
<p>start_dir : str
  Path to start directory</p>
<p>in_list : list
  Input file list. Defaults to recursive walk of current directory.</p>
<p>def_tag : str
  Default Dataverse tag (eg, Data, Documentation, etc)
  Separate tags with a comma:
  eg. (&lsquo;Data, 2016&rsquo;)</p>
<p>inc_header : bool
  Include header row</p>
<p>mime : bool
  Include automatically determined mimetype</p>
<ul>
<li><code>quotype</code> - int
  integer value or csv quote type.
  Default = csv.QUOTE_MINIMAL
  Acceptable values:
  csv.QUOTE_MINIMAL / 0
  csv.QUOTE_ALL / 1
  csv.QUOTE_NONNUMERIC / 2
  csv.QUOTE_NONE / 3</li>
</ul>
<p><a id="dataverse_utils.dataverse_utils.dump_tsv"></a></p>
<h5 id="dump_tsv">dump_tsv<a class="headerlink" href="#dump_tsv" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def dump_tsv(start_dir, filename, in_list=None, **kwargs)
</code></pre>
<p>Dumps output of make_tsv manifest to a file.</p>
<hr />
<p><strong>Arguments</strong>:</p>
<p>start_dir : str
  Path to start directory</p>
<p>in_list : list
  List of files for which to create manifest entries. Will
  default to recursive directory crawl</p>
<p>OPTIONAL KEYWORD ARGUMENTS</p>
<p>def_tag : str
  Default Dataverse tag (eg, Data, Documentation, etc)
  Separate tags with an easily splitable character:
  eg. (&lsquo;Data, 2016&rsquo;)
- <code>Default</code> - &lsquo;Data&rsquo;</p>
<p>inc_header : bool
  Include header for tsv.
  Default : True</p>
<ul>
<li><code>quotype</code> - int
  integer value or csv quote type.
  Default : csv.QUOTE_MINIMAL
  Acceptable values:
  csv.QUOTE_MINIMAL / 0
  csv.QUOTE_ALL / 1
  csv.QUOTE_NONNUMERIC / 2
  csv.QUOTE_NONE / 3</li>
</ul>
<p><a id="dataverse_utils.dataverse_utils.file_path"></a></p>
<h5 id="file_path">file_path<a class="headerlink" href="#file_path" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def file_path(fpath, trunc='') -&gt; str
</code></pre>
<p>Create relative file path from full path string</p>
<blockquote>
<blockquote>
<blockquote>
<p>file_path(&lsquo;/tmp/Data/2011/excelfile.xlsx&rsquo;, &lsquo;/tmp/&rsquo;)
&lsquo;Data/2011&rsquo;
file_path(&lsquo;/tmp/Data/2011/excelfile.xlsx&rsquo;, &lsquo;/tmp&rsquo;)
&lsquo;Data/2011&rsquo;</p>
</blockquote>
</blockquote>
</blockquote>
<hr />
<p><strong>Arguments</strong>:</p>
<p>fpath : str
  File location (ie, complete path)</p>
<p>trunc : str
  Leftmost portion of path to remove</p>
<p><a id="dataverse_utils.dataverse_utils.check_lock"></a></p>
<h5 id="check_lock">check_lock<a class="headerlink" href="#check_lock" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def check_lock(dv_url, study, apikey) -&gt; bool
</code></pre>
<p>Checks study lock status; returns True if locked.</p>
<hr />
<p><strong>Arguments</strong>:</p>
<p>dvurl : str
  URL of Dataverse installation</p>
<ul>
<li><code>study</code> - str
  Persistent ID of study</li>
</ul>
<p>apikey : str
  API key for user</p>
<p><a id="dataverse_utils.dataverse_utils.force_notab_unlock"></a></p>
<h5 id="force_notab_unlock">force_notab_unlock<a class="headerlink" href="#force_notab_unlock" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def force_notab_unlock(study, dv_url, fid, apikey, try_uningest=True) -&gt; int
</code></pre>
<p>Forcibly unlocks and uningests
to prevent tabular file processing. Required if mime and filename
spoofing is not sufficient.</p>
<p>Returns 0 if unlocked, file id if locked (and then unlocked).</p>
<hr />
<p><strong>Arguments</strong>:</p>
<p>study : str
  Persistent indentifer of study</p>
<p>dv_url : str
  URL to base Dataverse installation</p>
<p>fid : str
  File ID for file object</p>
<p>apikey : str
  API key for user</p>
<p>try_uningest : bool
  Try to uningest the file that was locked.
- <code>Default</code> - True</p>
<p><a id="dataverse_utils.dataverse_utils.uningest_file"></a></p>
<h5 id="uningest_file">uningest_file<a class="headerlink" href="#uningest_file" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def uningest_file(dv_url, fid, apikey, study='n/a')
</code></pre>
<p>Tries to uningest a file that has been ingested.
Requires superuser API key.</p>
<hr />
<p><strong>Arguments</strong>:</p>
<p>dv_url : str
  URL to base Dataverse installation</p>
<p>fid : int or str
  File ID of file to uningest</p>
<p>apikey : str
  API key for superuser</p>
<p>study : str
  Optional handle parameter for log messages</p>
<p><a id="dataverse_utils.dataverse_utils.upload_file"></a></p>
<h5 id="upload_file">upload_file<a class="headerlink" href="#upload_file" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def upload_file(fpath, hdl, **kwargs)
</code></pre>
<p>Uploads file to Dataverse study and sets file metadata and tags.</p>
<hr />
<p><strong>Arguments</strong>:</p>
<p>fpath : str
  file location (ie, complete path)</p>
<p>hdl : str
  Dataverse persistent ID for study (handle or DOI)</p>
<p>kwargs : dict</p>
<p>other parameters. Acceptable keywords and contents are:</p>
<p>dv : str
  REQUIRED
  url to base Dataverse installation
- <code>eg</code> - &lsquo;https://abacus.library.ubc.ca&rsquo;</p>
<p>apikey : str
  REQUIRED
  API key for user</p>
<p>descr : str
  OPTIONAL
  file description</p>
<p>md5 : str
  OPTIONAL
  md5sum for file checking</p>
<p>tags : list
  OPTIONAL
  list of text file tags. Eg [&lsquo;Data&rsquo;, &lsquo;June 2020&rsquo;]</p>
<p>dirlabel : str
  OPTIONAL
  Unix style relative pathname for Dataverse
  file path: eg: path/to/file/</p>
<p>nowait : bool
  OPTIONAL
  Force a file unlock and uningest instead of waiting for processing
  to finish</p>
<p>trunc : str
  OPTIONAL
  Leftmost portion of path to remove</p>
<p>rest : bool
  OPTIONAL
  Restrict file. Defaults to false unless True supplied</p>
<p>mimetype : str
  OPTIONAL
  Mimetype of file. Useful if using File Previewers. Mimetype for zip files
  (application/zip) will be ignored to circumvent Dataverse&rsquo;s automatic
  unzipping function.
  label : str
  OPTIONAL
  If included in kwargs, this value will be used for the label
  timeout = int
  OPTIONAL
  Timeout in seconds</p>
<p><a id="dataverse_utils.dataverse_utils.restrict_file"></a></p>
<h5 id="restrict_file">restrict_file<a class="headerlink" href="#restrict_file" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def restrict_file(**kwargs)
</code></pre>
<p>Restrict file in Dataverse study.</p>
<hr />
<p><strong>Arguments</strong>:</p>
<p>kwargs : dict</p>
<p>other parameters. Acceptable keywords and contents are:</p>
<p><strong>One of pid or fid is required</strong>
  pid : str
  file persistent ID</p>
<p>fid : str
  file database ID</p>
<p>dv : str
  REQUIRED
  url to base Dataverse installation
- <code>eg</code> - &lsquo;https://abacus.library.ubc.ca&rsquo;</p>
<p>apikey : str
  REQUIRED
  API key for user</p>
<p>rest : bool
  On True, restrict. Default True</p>
<p><a id="dataverse_utils.dataverse_utils.upload_from_tsv"></a></p>
<h5 id="upload_from_tsv">upload_from_tsv<a class="headerlink" href="#upload_from_tsv" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def upload_from_tsv(fil, hdl, **kwargs)
</code></pre>
<p>Utility for bulk uploading. Assumes fil is formatted
as tsv with headers &lsquo;file&rsquo;, &lsquo;description&rsquo;, &lsquo;tags&rsquo;.</p>
<p>&lsquo;tags&rsquo; field will be split on commas.</p>
<hr />
<p><strong>Arguments</strong>:</p>
<p>fil : filelike object
  Open file object or io.IOStream()</p>
<p>hdl : str
  Dataverse persistent ID for study (handle or DOI)</p>
<p>trunc : str
  Leftmost portion of Dataverse study file path to remove.
- <code>eg</code> - trunc =&rsquo;/home/user/&rsquo; if the tsv field is
  &lsquo;/home/user/Data/ASCII&rsquo;
  would set the path for that line of the tsv to &lsquo;Data/ASCII&rsquo;.
  Defaults to None.</p>
<p>kwargs : dict</p>
<p>other parameters. Acceptable keywords and contents are:</p>
<p>dv : str
  REQUIRED
  url to base Dataverse installation
- <code>eg</code> - &lsquo;https://abacus.library.ubc.ca&rsquo;</p>
<p>apikey : str
  REQUIRED
  API key for user</p>
<p>rest : bool
  On True, restrict access. Default False</p>
<p><a id="dataverse_utils.ldc"></a></p>
<h2 id="dataverse_utilsldc">dataverse_utils.ldc<a class="headerlink" href="#dataverse_utilsldc" title="Permanent link">&para;</a></h2>
<p>Creates dataverse JSON from Linguistic Data Consortium
website page.</p>
<p><a id="dataverse_utils.ldc.Ldc"></a></p>
<h3 id="ldc-objects">Ldc Objects<a class="headerlink" href="#ldc-objects" title="Permanent link">&para;</a></h3>
<pre><code class="language-python">class Ldc(ds.Serializer)
</code></pre>
<p>An LDC item (eg, LDC2021T01)</p>
<p><a id="dataverse_utils.ldc.Ldc.__init__"></a></p>
<h5 id="__init___4">__init__<a class="headerlink" href="#__init___4" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def __init__(ldc, cert=None)
</code></pre>
<p>Returns a dict with keys created from an LDC catalogue web
page.</p>
<hr />
<p><strong>Arguments</strong>:</p>
<p>ldc : str
  Linguistic Consortium Catalogue Number (eg. &lsquo;LDC2015T05&rsquo;.
  This is what forms the last part of the LDC catalogue URL.
  cert : str
  Path to certificate chain; LDC has had a problem
  with intermediate certificates, so you can
  download the chain with a browser and supply a
  path to the .pem with this parameter</p>
<p><a id="dataverse_utils.ldc.Ldc.ldcJson"></a></p>
<h5 id="ldcjson">ldcJson<a class="headerlink" href="#ldcjson" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">@property
def ldcJson()
</code></pre>
<p>Returns a JSON based on the LDC web page scraping</p>
<p><a id="dataverse_utils.ldc.Ldc.dryadJson"></a></p>
<h5 id="dryadjson">dryadJson<a class="headerlink" href="#dryadjson" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">@property
def dryadJson()
</code></pre>
<p>LDC metadata in Dryad JSON format</p>
<p><a id="dataverse_utils.ldc.Ldc.dvJson"></a></p>
<h5 id="dvjson">dvJson<a class="headerlink" href="#dvjson" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">@property
def dvJson()
</code></pre>
<p>LDC metadata in Dataverse JSON format</p>
<p><a id="dataverse_utils.ldc.Ldc.embargo"></a></p>
<h5 id="embargo">embargo<a class="headerlink" href="#embargo" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">@property
def embargo()
</code></pre>
<p>Boolean indicating embargo status</p>
<p><a id="dataverse_utils.ldc.Ldc.fileJson"></a></p>
<h5 id="filejson">fileJson<a class="headerlink" href="#filejson" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">@property
def fileJson(timeout=45)
</code></pre>
<p>Returns False: No attached files possible at LDC</p>
<p><a id="dataverse_utils.ldc.Ldc.files"></a></p>
<h5 id="files">files<a class="headerlink" href="#files" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">@property
def files()
</code></pre>
<p>Returns None. No files possible</p>
<p><a id="dataverse_utils.ldc.Ldc.fetch_record"></a></p>
<h5 id="fetch_record">fetch_record<a class="headerlink" href="#fetch_record" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def fetch_record(url=None, timeout=45)
</code></pre>
<p>Downloads record from LDC website</p>
<p><a id="dataverse_utils.ldc.Ldc.make_ldc_json"></a></p>
<h5 id="make_ldc_json">make_ldc_json<a class="headerlink" href="#make_ldc_json" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def make_ldc_json()
</code></pre>
<p>Returns a dict with keys created from an LDC catalogue web
page.</p>
<p><a id="dataverse_utils.ldc.Ldc.name_parser"></a></p>
<h5 id="name_parser">name_parser<a class="headerlink" href="#name_parser" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">@staticmethod
def name_parser(name)
</code></pre>
<p>Returns lastName/firstName JSON snippet from name</p>
<hr />
<p><strong>Arguments</strong>:</p>
<p>name : str
  A name</p>
<p><a id="dataverse_utils.ldc.Ldc.make_dryad_json"></a></p>
<h5 id="make_dryad_json">make_dryad_json<a class="headerlink" href="#make_dryad_json" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def make_dryad_json(ldc=None)
</code></pre>
<p>Creates a Dryad-style dict from an LDC dictionary</p>
<hr />
<p><strong>Arguments</strong>:</p>
<p>ldc : dict
  Dictionary containing LDC data. Defaults to self.ldcJson</p>
<p><a id="dataverse_utils.ldc.Ldc.find_block_index"></a></p>
<h5 id="find_block_index">find_block_index<a class="headerlink" href="#find_block_index" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">@staticmethod
def find_block_index(dvjson, key)
</code></pre>
<p>Finds the index number of an item in Dataverse&rsquo;s idiotic JSON list</p>
<hr />
<p><strong>Arguments</strong>:</p>
<p>dvjson : dict
  Dataverse JSON</p>
<p>key : str
  key for which to find list index</p>
<p><a id="dataverse_utils.ldc.Ldc.make_dv_json"></a></p>
<h5 id="make_dv_json">make_dv_json<a class="headerlink" href="#make_dv_json" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def make_dv_json(ldc=None)
</code></pre>
<p>Returns complete Dataverse JSON</p>
<hr />
<p><strong>Arguments</strong>:</p>
<p>ldc : dict
  LDC dictionary. Defaults to self.ldcJson</p>
<p><a id="dataverse_utils.ldc.Ldc.upload_metadata"></a></p>
<h5 id="upload_metadata">upload_metadata<a class="headerlink" href="#upload_metadata" title="Permanent link">&para;</a></h5>
<pre><code class="language-python">def upload_metadata(**kwargs) -&gt; dict
</code></pre>
<p>Uploads metadata to dataverse</p>
<p>Returns json from connection attempt.</p>
<hr />
<p><strong>Arguments</strong>:</p>
<p>kwargs:</p>
<p>url : str
  base url to Dataverse</p>
<p>key : str
  api key</p>
<p>dv : str
  Dataverse to which it is being uploaded</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../scripts/" class="btn btn-neutral float-left" title="Console utilities"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../faq/" class="btn btn-neutral float-right" title="FAQ">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../scripts/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../faq/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
